echo "ğŸš€ Pre-commit hook running..."

# Run type checking
echo "ğŸ” Running TypeScript type check..."
if ! pnpm run type-check; then
    echo "âŒ TypeScript type check failed!"
    echo "ğŸš« Commit blocked - please fix type errors before committing"
    exit 1
fi

# Run linting with strict error checking
echo "ğŸ” Running ESLint..."
if ! pnpm run lint; then
    echo "âŒ ESLint check failed!"
    echo "ğŸš« Commit blocked - please fix all linting errors and warnings before committing"
    exit 1
fi

# Run lint-staged (this will format and fix auto-fixable issues)
echo "ğŸ¨ Running lint-staged..."
if ! npx lint-staged; then
    echo "âŒ Lint-staged failed!"
    echo "ğŸš« Commit blocked - please fix formatting issues before committing"
    exit 1
fi

# Final verification - run lint again to ensure no issues remain after lint-staged
echo "ğŸ” Final ESLint verification..."
if ! pnpm run lint; then
    echo "âŒ Final ESLint check failed after formatting!"
    echo "ğŸš« Commit blocked - there are still linting issues that need manual attention"
    exit 1
fi

echo "âœ… All pre-commit checks passed! Proceeding with commit..."